<section class="logger">
    <button ng-show="logger.isFiltered()" class="reset btn btn-default pull-right" ng-click="logger.reset()">
    <i class="glyphicon glyphicon-repeat"></i>
    Reset filters
    </button>
    <h4 ng-if="logger.title" translate>logs.title</h4>

    <hr>
    <ol class="breadcrumb" ng-if="logger.log">    
    <li class="active" ng-if="logger.log">
        <a href="javascript:void(0);" ng-click="logger.closeLog()">
        <span translate>logs.all</span> <span class="badge">{{::logger.logs.length}}</span>
        </a>
    </li>
    <li class="active" ng-if="logger.log.trusted">{{::logger.log.changed.subject}}</li>
    <li class="active" ng-if="!logger.log.trusted">{{::logger.log.type}}</li>
    </ol>
    <table class="table table-condensed" ng-if="!logger.log">
        <thead ng-if="logger.filter">
            <tr>
            <th class="header-filter">
                <date model="logger.date"></date>
            </th>
            <th class="header-filter">
                <select class="pull-right form-control input-sm" ng-model="logger.admin" chosen>
                <option value="" translate>logs.allsender</option>
                <option ng-repeat="sender in logger.senders" value="{{::sender}}">{{::sender}}</option>
                </select>
                <span translate>logs.sender</span>
            </th>
            <th class="header-filter">
                <select class="pull-right form-control input-sm" ng-model="logger.target"
                ng-options="t.key as t.value for t in logger.targets" chosen>
                </select>
                <span translate>logs.target</span>
            </th>
            <th class="header-filter">
                <select class="pull-right form-control input-sm" ng-model="logger.type" chosen>
                <option value="" translate>logs.alltype</option>
                <option ng-repeat="type in logger.types" value="{{::type}}">{{::type}}</option>
                </select>
                <span translate>logs.type</span>
            </th>
            </tr>
        </thead>
        <thead ng-if="!logger.filter">
            <tr>
                <th translate>logs.date</th>
                <th translate>logs.sender</th>
                <th translate>logs.target</th>
                <th translate>logs.type</th>
            </tr>
        </thead>
    <tbody>
        <tr dir-paginate="log in logger.logs | logs: logger.type:logger.admin:logger.target:logger.date | orderBy: '-date' | itemsPerPage: logger.itemsPerPage">
            <td>{{::log.date | logDate}}
            <td><a ng-link="user({id: log.admin, tab: 'infos'})">{{::log.admin}}</a>
            <!--Target-->
            <td>
            <!--user or user's role modification-->
            <a ng-if="logger.getType(log) === 'USER'" ng-link="user({id: log.target, tab: 'infos'})">{{::log.target}}</a>
            <!--org-->
            <a ng-if="logger.getType(log) === 'ORG'" ng-link="org({org: log.target, tab: 'infos'})">
                <span ng-if="logger.orgsId[log.target]">{{::logger.orgsId[log.target]}}</span>
                <span ng-if="!logger.orgsId[log.target]">{{::log.target}}</span>
            </a>
            <!--role-->
            <a ng-if="logger.getType(log) === 'ROLE'" ng-link="role({role: log.target, tab: 'infos'})">
                {{::log.target}}</a>
            <!--refused or deleted-->
            <span ng-if="logger.getType(log) === ''">{{::log.target}}</span>
            </td>
            <!--Type-->
            <td ng-if="!log.changed"> {{::log.type}}
            <td>
            <a ng-if="log.changed && log.changed.field != log.target" ng-click="logger.openLog(log)" href="javascript:void(0);">
                {{::log.type + (log.changed.field ? ' (' + log.changed.field + ')' : '')}}
            </a>
            <span ng-if="log.changed && log.changed.field === log.target">
                {{::log.type + (log.changed.field ? ' (' + log.changed.field + ')' : '')}}
            </span>       
            </td>
        </tr>
    </tbody>
    </table>
    <!--Log as Email-->
    <div ng-if="logger.getDescription(log) === 'message'">
        <h4>
            <small ng-if="logger.log.trusted">
            <a ng-link="user({id: logger.log.changed.sender, tab: 'infos'})">{{::logger.log.changed.sender}}</a>
            <span translate> date.to</span>
            <a ng-link="user({id: logger.log.changed.recipient, tab: 'infos'})"> {{::logger.log.changed.recipient}}</a>,
            <span translate>msg.on</span> {{logger.log.date | date: 'mediumDate'}}
            </small>
        </h4>
        <!-- Email subject and body-->
        <h4 ng-if="logger.log.changed.subject">
            {{logger.log.changed.subject}}
        </h4>
        <p ng-if="logger.log.trusted" ng-bind-html="logger.log.trusted"></p>
        <hr ng-if="logger.log.changed.attachments.length>0" />
        <h5 ng-if="logger.log.changed.attachments.length>0" translate>msg.attachments</h5>
        <ul ng-if="logger.log.changed.attachments.length>0">
            <li ng-repeat="attachment in logger.log.attachments">
            {{attachment.name}}
            </li>
        </ul>
    </div>
    <!--Others logs type-->
    <div ng-if="logger.log && logger.getDescription(log) != 'message'">
        <h4>
            <small>
            <span translate>logs.target</span> 
            <!--display user name-->
            <a ng-if="logger.getType(logger.log) === 'USER'" ng-link="user({id: logger.log.target, tab: 'infos'})">
                {{::logger.log.target}}
            </a>
            <!--or display org name-->
            <a ng-if="logger.getType(logs.log) === 'ORG'" ng-link="org({org: logger.log.target, tab: 'infos'})">
                <span ng-if="logger.orgsId[log.target]">{{::logger.orgsId[logs.log.target]}}</span>
                <span ng-if="!logger.orgsId[log.target]">{{::logger.log.target}}</span>          
            </a>
            <!--or display target only if the target was removed-->
            <span ng-if="logger.getType(logger.log) === ''">{{::logger.log.target}}</span>
            <span translate>logs.to</span>
            <a ng-link="user({id: logger.log.admin, tab: 'infos'})">{{::logger.log.admin}}</a>, 
            <span translate>msg.on</span> {{logger.log.date | date: 'mediumDate'}}
            </small>
        </h4>
        <!--Display log details-->
        <h4 ng-if="logger.log.changed.type"><i>{{::logger.log.changed.type}}.</i></h4>
        <br>
        <p ng-if="!logger.log.changed.isRole"> 
            <span translate>logs.modification</span>
            <strong>{{::logger.log.changed.field}}.</strong>
        </p>
        <!--If value was replaced by another-->
        <p ng-if="logger.getDescription(log) === updateValue"> 
            <span translate>logs.replace</span> 
            <strong>{{::logger.log.changed.old}}</strong> 
            <span translate>logs.to</span> 
            <strong>{{::logger.log.changed.new}}.</strong>
        </p>
        <!--First value was set-->
        <p ng-if="logger.getDescription(log) === 'initValue'">
            <span translate>logs.set</span> 
            <strong ng-if="!logger.changed.isRole">{{::logger.log.changed.new}}.</strong>
        </p>
        <!--Field get an empty value-->
        <p ng-if="logger.getDescription(log) === 'clearValue'">
            <span translate>logs.clear</span> 
            <strong>{{::logger.log.changed.old}}.</strong>
        </p>
        <!--Special display for area modification-->
        <p ng-if="logger.getDescription(log) === 'changeArea'">
            <span ng-if="logger.log.changed.added"> 
            {{:: logger.log.changed.added}} 
            </span>
            <span ng-if="logger.log.changed.added" translate>logs.added </span>
            <span ng-if="logger.log.changed.new">: 
            <br> {{::logger.log.changed.new}} <br>
            </span>
            <span ng-if="logger.log.changed.removed"> 
            <br>{{::logger.log.changed.removed}}
            </span>
            <span ng-if="logger.log.changed.removed" translate>logs.removed </span>
            <span ng-if="logger.log.changed.old">:
            </br>{{::logger.log.changed.old}}
            </span>      
        </p>
    </div>
    <dir-pagination-controls ng-if="!logger.log.changed &&Â !logger.log.trusted"></dir-pagination-controls>
</section>